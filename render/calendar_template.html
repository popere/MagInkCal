<html>
  <head>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="bootstrap.min.css" />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="container p-0 m-0">
      <!-- Calendar -->
      <div class="calendar shadow bg-white p-3">
        <!-- Last update hour -->
        <!-- Weather -->
        <div>$weather</div>
        <!-- Month -->
        <div class="align-items-center text-center">
          <h3 class="month font-weight-bold mb-0 text-uppercase">$month</h3>
        </div>
        <!-- Battery -->
        <div class="batt_container">
          <img class="$battText" src="battery.png" />
        </div>
        <!-- Days of week -->
        <ol class="day-names list-unstyled text-center">
          $dayOfWeek
        </ol>
        <!-- Calendar and events -->
        <div>$events</div>
      </div>
    </div>
    <script>
      // const rainDataToday = [
      //   0, 0, 0, 0, 0, 0, 0, 1, 2, 0, 0, 0, 0, 0, 0, 0, 3, 5, 2, 0, 0, 0, 0, 0,
      // ];
      // const rainDataTomorrow = [
      //   0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 2, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      // ];
      // const rainDataAfter = [
      //   0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      // ];
      const rainDataToday = [$rainDataToday];
      const rainDataTomorrow = [$rainDataTomorrow];
      const rainDataAfter = [$rainDataAfter];

      // Nueva configuración de ticks
      const HOURS_MARKS_WIDTH_TEXT = [8, 12, 17, 22];

      const hoursMarks = Array.from({ length: 24 }, (_, i) => i);

      function renderChart(containerId, xId, data) {
        const max = Math.max(...data) || 1;
        const chart = document.getElementById(containerId);
        const xAxis = document.getElementById(xId);
        const currentHour = new Date().getHours();
        // Barras
        data.forEach((mm, i) => {
          const bar = document.createElement("div");
          bar.className = "bar";
          if (i === currentHour && containerId.includes("rainToday")) {
            bar.className += " current-hour";
          }
          bar.style.height = (mm / max) * 100 + "%";
          chart.appendChild(bar);
        });

        // Calcular posiciones de ticks en base a nº de barras
        const barCount = data.length;
        const barWidthPercent = 100 / barCount;

        hoursMarks.forEach((h) => {
          if (HOURS_MARKS_WIDTH_TEXT.includes(h)) return;
          const tick = document.createElement("div");
          tick.className = "tick";
          tick.style.left = h * barWidthPercent + barWidthPercent / 2 + "%";
          //tick.textContent = h + "h";
          xAxis.appendChild(tick);
        });

        HOURS_MARKS_WIDTH_TEXT.forEach((h) => {
          const tick = document.createElement("div");
          tick.className = "tick width-text";
          tick.style.left = h * barWidthPercent + barWidthPercent / 2 + "%";
          tick.textContent = h + " h";
          xAxis.appendChild(tick);
        });
        if (containerId.includes("rainToday")) {
          const tick = document.createElement("div");
          tick.className = "tick current-hour";
          tick.style.left =
            currentHour * barWidthPercent + barWidthPercent / 2 + "%";
          xAxis.appendChild(tick);
        }
      }
      for (const [i, v] of rainDataToday.entries()) {
        renderChart(`rainToday-${i}`, `xToday-${i}`, v);
      }
      for (const [i, v] of rainDataTomorrow.entries()) {
        renderChart(`rainTomorrow-${i}`, `xTomorrow-${i}`, v);
      }
      for (const [i, v] of rainDataAfter.entries()) {
        renderChart(`rainAfter-${i}`, `xAfter-${i}`, v);
      }
      window.status = "ready";
    </script>
  </body>
</html>
